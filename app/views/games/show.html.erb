<%# Gets all the info from the game model to update in game_subscription stimulus %>
<div class="game-show-container"
  data-controller="game-subscription challenge-instructions"
  data-game-subscription-game-id-value="<%= @game.id %>"
  data-game-subscription-user-id-value="<%= current_user.id %>"
  data-game-subscription-player-one-id-value="<%= @game.player_one.id %>"
  data-game-subscription-player-two-id-value="<%= @game.player_two.id %>"
  data-game-subscription-update-url="<%= game_path(@game) %>"
  data-game-subscription-loaded-value="<%= false %>"
  data-game-subscription-rounds-value="<%= @rounds %>"
  data-game-subscription-game-round-method-value="<%= @rounds_left.challenge.method_template %>">
  <h3> <%= @action_users_connected %> </h3>

  <div data-game-subscription-target="roundWinnerModal" id="roundWinnerModal" class="round-winner-modal">
    <div data-game-subscription-target="roundWinnerModalContent" class="round-winner-modal-content">
      <span class="round-winner-modal-close">&times;</span>
      <p data-game-subscription-target="roundWinner"></p>
      <div class="tally-container">
        <div>
          <p ><%= @game.player_one.username %> Wins:</p>
          <p data-game-subscription-target="roundWinnerCountp1"></p>
        </div>
        <div>
          <p><%= @game.player_two.username %> Wins:</p>
          <p data-game-subscription-target="roundWinnerCountp2"></p>
        </div>
      </div>
      <button data-action="click->game-subscription#nextRound">Next Round</button>
    </div>
  </div>

  <div data-game-subscription-target="gameWinnerModal" id="gameWinnerModal" class="game-winner-modal">
    <div class="game-winner-modal-content">
      <span class="game-winner-modal-close">&times;</span>
      <p data-game-subscription-target="gameWinner"></p>
      <div class="tally-container">
        <div>
          <p ><%= @game.player_one.username %> Wins:</p>
          <p data-game-subscription-target="gameWinnerCountp1"></p>
        </div>
        <div>
          <p><%= @game.player_two.username %> Wins:</p>
          <p data-game-subscription-target="gameWinnerCountp2"></p>
        </div>
      </div>
      <button data-action="click->game-subscription#endGame">Back to Dashboard</button>
    </div>
  </div>

  <div class="game-show-left">
    <div class="page-section game-information">
      <h3> <%= @rounds_left.id %> / <%= @game.round_count %></h3>
      <div>
        <%= image_tag(@game.player_one.avatar, class: "user-avatar-big") %> <span>V</span> <%= image_tag(@game.player_two.avatar, class: "user-avatar-big") %>
      </div>
    </div>

    <div class="page-section challenge-instructions">
      <h4>Instructions</h4>
      <p><%= @rounds_left.challenge.description %></p>
    </div>

    <div class="page-section challenge-tests">
      <h4>Test results</h4>
      <p data-game-subscription-target="output">Awaiting code submission</p>
    </div>
  </div>

  <div class="game-show-right <%= "game-show-right-reversed" if current_user == @game.player_two %>">
    <div class="user-codebox <%= "current-player-codebox" if current_user == @game.player_one %>" id="user-codebox-1" data-action="keyup->game-subscription#playerTyping">
      <div class="user-details">
        <div><%= image_tag(@game.player_one.avatar, class: "user-avatar") %></div>
        <h2 class="user-name"><%= @game.player_one.username %></h2>
      </div>
      <textarea data-game-subscription-target="editorone"></textarea>
      <% if @game.player_one == current_user %>
        <div class="code-submit-buttons">
          <button id="playerOneClear" class="btn btn-second" data-action="click->game-subscription#clearPlayerSubmission">Clear</button>
          <button id="playerOneTest" class="btn btn-main" data-action="click->game-subscription#playerSubmission click->challenge-instructions#showTests">Submit</button>
          <button id="playerOneSubmit" class="btn btn-second">ðŸ˜€ðŸ˜ ðŸŽ‰</button>
        </div>
      <% end %>
    </div>

    <div class="user-codebox <%= "current-player-codebox" if current_user == @game.player_two %>" id="user-codebox-2" data-action="keyup->game-subscription#playerTyping">
      <div class="user-details">
        <div><%= image_tag(@game.player_two.avatar, class: "user-avatar") %></div>
        <h2 class="user-name"><%= @game.player_two.username %></h2>
      </div>
      <textarea data-game-subscription-target="editortwo"></textarea>
      <% if @game.player_two == current_user %>
        <div class="code-submit-buttons">
          <button id="playerTwoClear" class="btn btn-second" data-action="click->game-subscription#clearPlayerSubmission">Clear</button>
          <button id="playerTwoTest" class="btn btn-main"  data-action="click->game-subscription#playerSubmission click->challenge-instructions#showTests">Submit</button>
          <button id="playerTwoSubmit" class="btn btn-second">ðŸ˜€ðŸ˜ ðŸŽ‰</button>
        </div>
      <% end %>
    </div>
  </div>
</div>
